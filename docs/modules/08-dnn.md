---
layout: default
title: "08: Deep Learning"
parent: Modules
nav_order: 8
permalink: /modules/08-dnn
---

# Module 8: Deep Learning (DNN)
{: .fs-9 }

Using deep neural networks for inference in OpenCV.
{: .fs-6 .fw-300 }

---

## Topics Covered

- DNN module overview
- Model loading (TensorFlow, Caffe, ONNX, Darknet)
- Blob preparation
- Inference pipeline
- Classification and detection

---

## Algorithm Explanations

### 1. DNN Inference Pipeline

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     OpenCV DNN Inference                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                     â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚   â”‚ Load      â”‚    â”‚ Create    â”‚    â”‚ Run       â”‚    â”‚ Post-    â”‚ â”‚
â”‚   â”‚ Model     â”‚â”€â”€â”€â–¶â”‚ Blob      â”‚â”€â”€â”€â–¶â”‚ Inference â”‚â”€â”€â”€â–¶â”‚ Process  â”‚ â”‚
â”‚   â”‚           â”‚    â”‚           â”‚    â”‚           â”‚    â”‚          â”‚ â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚        â”‚                â”‚                â”‚                â”‚        â”‚
â”‚        â–¼                â–¼                â–¼                â–¼        â”‚
â”‚   .weights/.pb     blobFromImage    net.forward()    Parse        â”‚
â”‚   .cfg/.onnx       (normalize,      (GPU/CPU)        outputs      â”‚
â”‚                    resize)                                         â”‚
â”‚                                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Supported Frameworks**:

| Framework | Model File | Config File |
|:----------|:-----------|:------------|
| TensorFlow | `.pb` | `.pbtxt` |
| Caffe | `.caffemodel` | `.prototxt` |
| Darknet/YOLO | `.weights` | `.cfg` |
| ONNX | `.onnx` | - |

---

### 2. Blob Transformation

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  blobFromImage() Transformation                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                     â”‚
â”‚   Input Image (HWC)                    Output Blob (NCHW)          â”‚
â”‚   OpenCV format                        Neural network format       â”‚
â”‚                                                                     â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚   â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚                    â”‚ Batch 0             â”‚     â”‚
â”‚   â”‚ â”‚   Blue    â”‚ â”‚                    â”‚ â”Œâ”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”       â”‚     â”‚
â”‚   â”‚ â”‚  Channel  â”‚ â”‚                    â”‚ â”‚ R â”‚ G â”‚ B â”‚       â”‚     â”‚
â”‚   â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚   blobFromImage()  â”‚ â”‚   â”‚   â”‚   â”‚       â”‚     â”‚
â”‚   â”‚ â”‚   Green   â”‚ â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶ â”‚ â”‚ C â”‚ C â”‚ C â”‚       â”‚     â”‚
â”‚   â”‚ â”‚  Channel  â”‚ â”‚   â€¢ resize         â”‚ â”‚ h â”‚ h â”‚ h â”‚       â”‚     â”‚
â”‚   â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚   â€¢ scale          â”‚ â”‚ a â”‚ a â”‚ a â”‚       â”‚     â”‚
â”‚   â”‚ â”‚   Red     â”‚ â”‚   â€¢ mean subtract  â”‚ â”‚ n â”‚ n â”‚ n â”‚       â”‚     â”‚
â”‚   â”‚ â”‚  Channel  â”‚ â”‚   â€¢ swap Râ†”B       â”‚ â”‚   â”‚   â”‚   â”‚       â”‚     â”‚
â”‚   â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚                    â”‚ â””â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”˜       â”‚     â”‚
â”‚   â”‚    H Ã— W Ã— 3  â”‚                    â”‚   1 Ã— 3 Ã— H Ã— W     â”‚     â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                                                                     â”‚
â”‚   Shape: (480, 640, 3)       â†’         Shape: (1, 3, 224, 224)     â”‚
â”‚                                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Common Preprocessing**:

| Model | scalefactor | size | mean | swapRB |
|:------|:------------|:-----|:-----|:-------|
| ImageNet | 1/255 | (224, 224) | (0, 0, 0) | True |
| SSD | 1.0 | (300, 300) | (104, 177, 123) | False |
| YOLO | 1/255 | (416, 416) | (0, 0, 0) | True |

---

### 3. Classification Pipeline

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Image Classification                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                     â”‚
â”‚   Input Image         Neural Network           Output Vector       â”‚
â”‚                                                                     â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚   Cat     â”‚      â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚      â”‚  cat:     0.92   â”‚   â”‚
â”‚   â”‚  Image    â”‚  â”€â”€â–¶ â”‚ â”‚ Conv   â”‚ â”‚  â”€â”€â–¶ â”‚  dog:     0.05   â”‚   â”‚
â”‚   â”‚           â”‚      â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚      â”‚  bird:    0.02   â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚ â”‚ Conv   â”‚ â”‚      â”‚  car:     0.01   â”‚   â”‚
â”‚                       â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚      â”‚  ...             â”‚   â”‚
â”‚   224Ã—224Ã—3          â”‚ â”‚  FC    â”‚ â”‚      â”‚                   â”‚   â”‚
â”‚                       â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚      â”‚  N classes        â”‚   â”‚
â”‚                       â”‚ â”‚Softmax â”‚ â”‚      â”‚  (probabilities)  â”‚   â”‚
â”‚                       â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                              â”‚
â”‚                                                                     â”‚
â”‚   argmax() â†’ class_id = 0 (cat)                                    â”‚
â”‚                                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### 4. Object Detection (YOLO)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    YOLO Detection Pipeline                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                     â”‚
â”‚   Input Image         Grid Division          Predictions           â”‚
â”‚                                                                     â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”      Each cell predicts:       â”‚
â”‚   â”‚   ğŸš—      â”‚      â”‚   â”‚   â”‚   â”‚      â€¢ B bounding boxes         â”‚
â”‚   â”‚     ğŸš¶   â”‚  â”€â”€â–¶ â”œâ”€â”€â”€â”¼â”€â”€â”€â”¼â”€â”€â”€â”¤      â€¢ Confidence scores        â”‚
â”‚   â”‚  ğŸš—      â”‚      â”‚   â”‚ x â”‚   â”‚      â€¢ C class probabilities    â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”œâ”€â”€â”€â”¼â”€â”€â”€â”¼â”€â”€â”€â”¤                                 â”‚
â”‚                       â”‚   â”‚   â”‚   â”‚      S Ã— S Ã— (B Ã— 5 + C)       â”‚
â”‚   416Ã—416            â””â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”˜      output tensor              â”‚
â”‚                       S Ã— S grid                                    â”‚
â”‚                                                                     â”‚
â”‚   Post-processing:                                                 â”‚
â”‚   1. Filter by confidence threshold                                â”‚
â”‚   2. Apply Non-Maximum Suppression (NMS)                          â”‚
â”‚   3. Draw bounding boxes                                           â”‚
â”‚                                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Tutorial Files

| File | Description |
|:-----|:------------|
| `01_dnn_basics.py` | Loading models, blob preparation, inference |

---

## Key Functions Reference

| Function | Description |
|:---------|:------------|
| `cv2.dnn.readNet()` | Load model |
| `cv2.dnn.blobFromImage()` | Create input blob |
| `net.setInput()` | Set network input |
| `net.forward()` | Run inference |
| `cv2.dnn.NMSBoxes()` | Non-max suppression |

---

## Further Reading

- [OpenCV DNN Module](https://docs.opencv.org/4.x/d2/d58/tutorial_table_of_content_dnn.html)
